
<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TonMriyaBot ‚Äî –°–∫—Ä–∏–Ω—ñ –∑–∞ Stars</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial;color:#fff;background:#0f1318}
    .wrap{max-width:720px;margin:0 auto;padding:24px}
    h1{font-size:22px;margin:0 0 16px}
    .btn{display:block;width:100%;padding:14px 16px;margin:12px 0;border:0;border-radius:10px;
         background:#1da1f2;color:#fff;font-weight:700;font-size:18px;cursor:pointer}
    .btn:disabled{opacity:.6;cursor:not-allowed}
    .status{margin-top:12px;font-size:16px;min-height:1.4em}
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div class="wrap">
    <h1>–°–∫—Ä–∏–Ω—ñ –∑–∞ Stars</h1>

    <!-- –ö–Ω–æ–ø–∫–∏ –∑ data-* –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏ -->
    <button class="btn buy" data-sku="small"  data-amount="1000">–ú–∞–ª–∞ —Å–∫—Ä–∏–Ω—è ‚Äî 1 000 ‚≠ê</button>
    <button class="btn buy" data-sku="medium" data-amount="3000">–°–µ—Ä–µ–¥–Ω—è —Å–∫—Ä–∏–Ω—è ‚Äî 3 000 ‚≠ê</button>
    <button class="btn buy" data-sku="big"    data-amount="10000">–í–µ–ª–∏–∫–∞ —Å–∫—Ä–∏–Ω—è ‚Äî 10 000 ‚≠ê</button>

    <div id="buy-status" class="status"></div>
  </div>

  <script>
    // 1) –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Telegram WebApp
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // 2) –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
    const API_URL = "https://YOUR_BACKEND_DOMAIN"; // ‚Üê –ó–ê–ú–Ü–ù–ò –Ω–∞ —Å–≤—ñ–π –±–µ–∫–µ–Ω–¥ (https!)

    // 3) –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó
    const $status = document.getElementById("buy-status");
    function setStatus(t){ $status.textContent = t || ""; }
    function setLoading(on){
      document.querySelectorAll(".buy").forEach(b => b.disabled = !!on);
    }

    // 4) –ü–æ–∫—É–ø–∫–∞ –∑–∞ Stars
    async function buyStars(sku, amountXTR){
      try{
        setLoading(true);
        setStatus("–ì–æ—Ç—É—î–º–æ —ñ–Ω–≤–æ–π—Å‚Ä¶");

        const resp = await fetch(`${API_URL}/api/create-stars-invoice`, {
          method: "POST",
          headers: {"Content-Type":"application/json"},
          body: JSON.stringify({
            initData: tg.initData || tg.initDataUnsafe, // –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ!
            sku,
            amount: amountXTR // XTR (—Ü—ñ–ª–µ —á–∏—Å–ª–æ)
          })
        });

        const data = await resp.json().catch(()=> ({}));
        if(!resp.ok || !data?.invoice_link){
          throw new Error(data?.error || "–°–µ—Ä–≤–µ—Ä –Ω–µ –ø–æ–≤–µ—Ä–Ω—É–≤ invoice_link");
        }

        // 5) –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ —ñ–Ω–≤–æ–π—Å —É Telegram
        tg.openInvoice(data.invoice_link, (status) => {
          if (status === "paid")       setStatus("‚úÖ –û–ø–ª–∞—á–µ–Ω–æ!");
          else if (status === "failed")    setStatus("‚ùå –ü–æ–º–∏–ª–∫–∞ –æ–ø–ª–∞—Ç–∏");
          else if (status === "cancelled") setStatus("üö´ –°–∫–∞—Å–æ–≤–∞–Ω–æ");
          else                           setStatus("‚è≥ –û—á—ñ–∫—É—î–º–æ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è‚Ä¶");
        });

      }catch(err){
        console.error(err);
        setStatus("‚ùó " + (err?.message || "–°—Ç–∞–ª–∞—Å—è –ø–æ–º–∏–ª–∫–∞"));
        tg.showPopup?.({title:"–ü–æ–º–∏–ª–∫–∞", message: String(err?.message || err)});
      }finally{
        setLoading(false);
      }
    }

    // 6) –ü—Ä–∏–≤‚Äô—è–∑—É—î–º–æ –∫–ª–∏–∫–∏ –¥–æ –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll(".buy").forEach(btn => {
      btn.addEventListener("click", () => {
        const sku = btn.dataset.sku;
        const amount = parseInt(btn.dataset.amount, 10);
        buyStars(sku, amount);
      }, {passive:true});
    });
  </script>
</body>
</html>
